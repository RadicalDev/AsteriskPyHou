#!/usr/bin/python

import sys
sys.path.append("../lib")

from database import Sqlite3Database
from ami import AMI
from functions import sms
from database import Sqlite3Database


def game1():
    main_line = '8322611494'
    db = Sqlite3Database("../etc/users.db")
    users = db.dquery("users", fetchall=True)

    ami = AMI()
    for user in users:
        ami.create_call(user['phonenumber'], main_line, main_line, 'game-one', user['phonenumber'])


def game2():
    number = "8322611494"

    db = Sqlite3Database("../etc/users.db")
    users = db.dquery("users", fetchall=True)

    for user in users:
        code = open("/etc/secret_code", 'r').read().strip()
        msg = "Hurry! Call {0} and enter {1} when prompted".format(number, code)
        print user['phonenumber'], ": ", msg
        sms(user['phonenumber'], msg)


def game3():
    main_line = '2818097414'
    db = Sqlite3Database("../etc/users.db")
    users = db.dquery("users", fetchall=True)

    ami = AMI()
    for user in users:
        ami.create_call(user['phonenumber'], main_line,
                        main_line, 'game-three', user['phonenumber'])


games = {'1':game1, '2':game2, '3':game3}

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print "launch_game <game_number>"
        sys.exit(1)

    game_number = sys.argv[1]
    if game_number in games:
        games[game_number]()
        print "Started game number ", game_number

